# =============================================================================
# Shell Functions
# =============================================================================
# Custom shell functions for git workflows and utilities.
# Sourced by: shell/zshrc
#
# Key functions:
#   g              - git status (or git <args>)
#   gc <message>   - Quick commit (no quotes needed)
#   git-done       - Merge to main, push, cleanup branch
#   git-nuke       - Delete branch locally and remotely
#   git-on-main    - Rebase current branch on main
#   take <dir>     - mkdir and cd in one command
# =============================================================================

# Get the current git branch name
function git_branch_name {
    git rev-parse --abbrev-ref HEAD 2>/dev/null
}

# Create a new branch and push it to origin with tracking
function git-new-remote-tracking {
    git checkout -b $1 && git push -u origin $1
}

# Merge current branch to main, push, and cleanup
function git-done {
    local branch=$(git_branch_name)
    if [[ "$branch" == "main" ]]; then
        echo "Already on main branch"
        return 1
    fi
    git checkout main && \
    git merge $branch --ff-only && \
    git push && \
    git branch -D $branch && \
    git push origin :$branch
}

# Delete a branch locally and remotely
function git-nuke {
    git branch -D $1 && git push origin :$1
}

# Rebase current branch on main
function git-on-main {
    local branch=$(git_branch_name)
    git checkout main && git pull --rebase
    git checkout $branch
    git rebase main
}

# Git status or run git command
function g {
    if [[ $# -gt 0 ]]; then
        git $@
    else
        git status
    fi
}
compdef g=git

# Search rake routes
function rrg {
    rake routes | grep $1
}

# Create directory and cd into it
function take {
    mkdir -p $1 && cd $1
}

# Quick commit with message (no quotes needed)
function gc {
    git commit -m "$*"
}

# =============================================================================
# Claude Code Multi-Account (Work machine only)
# =============================================================================
# Auto-switch between work and personal Claude Code accounts based on directory.
# Personal projects in ~/personal-projects use personal account, all else uses work.
# Use explicit aliases (claude-work, claude-personal) to override auto-detection.
# Only active on work machine (sean-coral-macbook-air).

if [[ "$(scutil --get LocalHostName 2>/dev/null)" == "sean-coral-macbook-air" ]]; then
    function claude {
        if [[ "$PWD" == "$HOME/personal-projects"* ]]; then
            echo "â€º Using personal Claude account"
            CLAUDE_CONFIG_DIR=~/.claude-personal command claude "$@"
        else
            CLAUDE_CONFIG_DIR=~/.claude-work command claude "$@"
        fi
    }
fi
